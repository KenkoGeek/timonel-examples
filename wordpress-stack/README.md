# WordPress Stack Example

This example demonstrates how to compose a production-friendly WordPress + MySQL deployment using
Timonel's umbrella chart tooling. The project mirrors the structure generated by `tl umbrella init`
and showcases how to model advanced features such as secrets, ingress, and horizontal pod autoscaling
while keeping subcharts reusable.

## Project Layout

```
timonel-examples/wordpress-stack/
├── charts/
│   ├── mysql/
│   │   └── chart.ts        # Timonel chart for the MySQL backend
│   └── wordpress/
│       └── chart.ts        # Timonel chart for the WordPress frontend
├── umbrella.config.json    # CLI-authored manifest linking subcharts
├── umbrella.ts             # Umbrella orchestration with mode switching
└── README.md               # This guide
```

## Prerequisites

- Node.js 18+
- Helm 3 (for chart validation)
- The Timonel library installed globally or locally to use the CLI (`tl`) 

## Synthesize the Umbrella Chart

From the example directory run:

```bash
cd timonel-examples/wordpress-stack
tl umbrella synth
```

The command writes the chart to `dist/` using the default **dependencies** mode, which packages
subcharts under `dist/charts/` and records them as Helm dependencies.

Switch to inline mode when you prefer a single flat chart:

```bash
tl umbrella synth --mode inline
```

Inline mode copies each subchart's templates under `dist/templates/<subchart>/` and removes the
`dependencies` section from `Chart.yaml`.

## Validate with Helm

```bash
cd timonel-examples/wordpress-stack/dist
helm lint .
helm template wordpress-stack .
```

Use `helm install wordpress-stack . --namespace wordpress-stack --create-namespace` to deploy to a
cluster.

## Customisation Tips

- Adjust scaling thresholds, images, and ingress defaults via `dist/values.yaml` or by passing
  `--set` flags to `tl umbrella synth`.
- For persistent WordPress content, replace the `EmptyDir` volume in `charts/wordpress/chart.ts` with
  a PVC definition.
- Supply production-grade credentials by overriding `mysql.*` values before synthesizing; the chart
  already pulls secrets from `mysql-credentials`.

## Further Reading

- [Wiki: WordPress + MySQL Complete Example](https://github.com/KenkoGeek/timonel/wiki/WP-Complete-Example)
  – step-by-step walkthrough aligned with this project.
- [Wiki: CLI Reference](https://github.com/KenkoGeek/timonel/wiki/CLI-Reference) – additional umbrella
  chart options (`--mode`, `--set`, `--env`).
